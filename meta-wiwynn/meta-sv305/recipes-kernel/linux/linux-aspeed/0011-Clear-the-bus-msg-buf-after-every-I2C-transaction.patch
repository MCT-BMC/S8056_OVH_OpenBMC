From 256d324d97d925c762bdde2ebbb78f4dfb228697 Mon Sep 17 00:00:00 2001
From: Eli Huang <Eli_Huang@wiwynn.com>
Date: Mon, 15 Mar 2021 15:29:34 +0800
Subject: [PATCH] Clear the bus msg buf after every I2C transaction

---
 drivers/i2c/busses/i2c-aspeed.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/drivers/i2c/busses/i2c-aspeed.c b/drivers/i2c/busses/i2c-aspeed.c
index 1ad74efcab37..09e4d691986a 100644
--- a/drivers/i2c/busses/i2c-aspeed.c
+++ b/drivers/i2c/busses/i2c-aspeed.c
@@ -690,6 +690,9 @@ static int aspeed_i2c_master_xfer(struct i2c_adapter *adap,
 
 	time_left = wait_for_completion_timeout(&bus->cmd_complete,
 						bus->adap.timeout);
+	spin_lock_irqsave(&bus->lock, flags);
+	bus->msgs = NULL;
+	spin_unlock_irqrestore(&bus->lock, flags);
 
 	if (time_left == 0) {
 		/*
-- 
2.28.0

